<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ GitHub File Uploader (Secure Version)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS Styles (á€šá€á€„á€ºá€¡á€á€­á€¯á€„á€ºá€¸) */
        :root {--primary-color: #4a90e2; --primary-hover: #357bd8; /* ... */ }
        /* ... */
        .status-success a { color: var(--primary-color); text-decoration: underline; word-break: break-all; }
        .status-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        /* ... (á€€á€»á€”á€ºá€á€±á€¬ CSS á€™á€»á€¬á€¸) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ GitHub á€–á€­á€¯á€„á€º Upload á€…á€”á€…á€º</h1>

        <div class="counter-card-wrapper">
            <div class="counter-card">
                <span class="counter-label">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ Upload á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€™á€¾á€¯</span>
                <span id="uploadCounter" class="counter-value">...</span>
            </div>
        </div>
        
        <div class="input-group">
            <label for="fileInput">ğŸ“‚ Upload á€œá€¯á€•á€ºá€™á€šá€·á€º á€–á€­á€¯á€„á€º á€›á€½á€±á€¸á€•á€«:</label>
            <input type="file" id="fileInput">
        </div>

        <div class="input-group">
            <label for="repoPath">ğŸ“ GitHub á€œá€™á€ºá€¸á€€á€¼á€±á€¬á€„á€ºá€¸:</label>
            <input type="text" id="repoPath" placeholder="á€–á€­á€¯á€„á€ºá€›á€½á€±á€¸á€á€»á€šá€ºá€•á€¼á€®á€¸á€•á€«á€€ á€–á€­á€¯á€„á€ºá€”á€¬á€™á€Šá€ºá€–á€¼á€„á€·á€º á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€ºá€•á€±á€«á€ºá€œá€¬á€•á€«á€™á€Šá€º">
        </div>

        <button id="uploadButton">ğŸ“¤ GitHub á€á€­á€¯á€· Upload á€œá€¯á€•á€ºá€™á€Šá€º</button>
        
        <div id="statusMessage" class="status-waiting">á€¡á€á€¼á€±á€¡á€”á€±: Upload á€…á€á€„á€ºá€›á€”á€º á€¡á€†á€„á€ºá€á€„á€·á€º</div>
    </div>
    
    <div id="floatingFbBtn" title="á€†á€€á€ºá€á€½á€šá€ºá€›á€”á€º (Facebook)">
        <i class="fab fa-facebook-f"></i>
    </div>

    <script>
        // âš ï¸ GITHUB_TOKEN á€€á€­á€¯ á€œá€¯á€¶á€¸á€á€–á€šá€ºá€›á€¾á€¬á€¸á€œá€­á€¯á€€á€ºá€•á€¼á€®á‹

        // ğŸ›‘ á€á€„á€·á€ºá€›á€²á€· GitHub/Facebook á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€¤á€”á€±á€›á€¬á€á€½á€„á€º á€•á€¼á€„á€ºá€†á€„á€ºá€•á€«á‹
        const REPO_OWNER = "tn69code"; 
        const REPO_NAME = "filesupload";
        const COUNTER_FILE_PATH = "upload_count.json"; 
        const BRANCH_NAME = "main"; 
        const FACEBOOK_URL = "YOUR_FACEBOOK_URL_HERE"; 
        const BASE_URL_FOR_CONTENT = "https://github-uploader.tak.today"; // Custom Domain URL

        const fileInput = document.getElementById('fileInput');
        const repoPathInput = document.getElementById('repoPath');
        const uploadButton = document.getElementById('uploadButton');
        const uploadCounterElement = document.getElementById('uploadCounter');
        const floatingFbBtn = document.getElementById('floatingFbBtn'); 
        // ... (á€€á€»á€”á€ºá€á€±á€¬ element selection á€™á€»á€¬á€¸) ...

        // --- Modal & Floating Button Logic (á€šá€á€„á€ºá€¡á€á€­á€¯á€„á€ºá€¸) ---
        // ...

        // --- Counter Logic (GitHub Pages á€™á€¾ á€–á€á€ºá€á€Šá€º) ---
        async function initializeCounter() {
            const timestamp = new Date().getTime(); 
            const apiUrl = `${BASE_URL_FOR_CONTENT}/${COUNTER_FILE_PATH}?t=${timestamp}`;
            uploadCounterElement.textContent = '...'; 

            try {
                const response = await fetch(apiUrl);
                if (response.status === 200) {
                    let data = {};
                    try { data = await response.json(); } 
                    catch (e) { console.warn('JSON parsing error.'); uploadCounterElement.textContent = 0; return; }
                    uploadCounterElement.textContent = data.count || 0; 
                } else if (response.status === 404) {
                    uploadCounterElement.textContent = 0; 
                } else {
                     uploadCounterElement.textContent = `Error ${response.status}`;
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                uploadCounterElement.textContent = 'âŒ';
            }
        }
        
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) { const selectedFile = this.files[0]; const originalFileName = selectedFile.name; repoPathInput.value = `uploads/${originalFileName}`; } 
            else { repoPathInput.value = ''; }
        });

        uploadButton.addEventListener('click', handleUpload);
        window.addEventListener('load', initializeCounter); 

        // --- Upload Logic (Netlify Function API á€€á€­á€¯ á€á€±á€«á€ºá€†á€­á€¯á€á€¼á€„á€ºá€¸) ---
        async function handleUpload() {
            const statusElement = document.getElementById('statusMessage');
            const repoPath = repoPathInput.value.trim();
            const file = fileInput.files[0];

            if (fileInput.files.length === 0 || !repoPath) { statusElement.innerHTML = `<p>âŒ á€–á€­á€¯á€„á€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º GitHub á€œá€™á€ºá€¸á€€á€¼á€±á€¬á€„á€ºá€¸ á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€›á€”á€º á€œá€­á€¯á€¡á€•á€ºá€•á€«á€á€Šá€ºá‹</p>`; statusElement.className = 'status-error'; return; }

            statusElement.textContent = `1/2: Checking file and encoding...`;
            statusElement.className = 'status-waiting';

            try {
                const base64Content = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result.split('base64,')[1]);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });

                statusElement.textContent = `2/2: Sending request to Netlify server...`;
                
                // Netlify Function API á€á€±á€«á€ºá€†á€­á€¯á€á€¼á€„á€ºá€¸
                const apiResponse = await fetch('/.netlify/functions/upload', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        path: repoPath,
                        content: base64Content,
                        fileName: file.name
                    })
                });

                if (apiResponse.status !== 200) {
                    const errorData = await apiResponse.json();
                    throw new Error(errorData.error || `Server Error: ${apiResponse.statusText}`);
                }

                const result = await apiResponse.json(); 
                
                statusElement.textContent = `Upload successful. Counter updated to ${result.newCount}`;
                
                // UI Update
                uploadCounterElement.textContent = result.newCount;
                
                // Link á€•á€¼á€á€á€¼á€„á€ºá€¸
                const viewCodeProxyUrl = `/.netlify/functions/view-raw?path=${result.path}`; 
                
                const message = 'âœ… á€–á€­á€¯á€„á€ºá€¡á€¬á€¸ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹';

                statusElement.innerHTML = `
                    <p>${message}</p>
                    <p>Code View Link (Proxy):</p>
                    <a href="${viewCodeProxyUrl}" target="_blank" style="word-break: break-all;">${viewCodeProxyUrl}</a>
                `;
                statusElement.className = 'status-success';

            } catch (error) {
                console.error('Upload Error:', error);
                const displayError = error.message;

                statusElement.innerHTML = `
                    <p>âŒ Upload á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á‹</p>
                    <p>Error: ${displayError}</p>
                `;
                statusElement.className = 'status-error';
            }
        }
    </script>
</body>
</html>
